From 0f2f4616f2810ac6821ac8f85952874f422007c8 Mon Sep 17 00:00:00 2001
From: Emilio Pozuelo Monfort <pochu27@gmail.com>
Date: Sat, 12 Mar 2011 22:09:11 +0000
Subject: [PATCH] Run gio tests with a dbus session

Some gio tests (e.g. gapplication) need a running dbus session
to work, so we run them with dbus-launch, which prepares the
dbus session.
---
 glib.mk         |    2 +-
 gio/tests/Makefile.am |    3 +++
 2 files changed, 4 insertions(+), 1 deletions(-)

--- a/glib.mk
+++ b/glib.mk
@@ -2,7 +2,7 @@
 
 #GTESTER = gtester 			# for non-GLIB packages
 #GTESTER_REPORT = gtester-report        # for non-GLIB packages
-GTESTER = $(top_builddir)/glib/gtester			# for the GLIB package
+GTESTER = $(GTESTER_ENV) $(top_builddir)/glib/gtester	# for the GLIB package
 GTESTER_REPORT = $(top_builddir)/glib/gtester-report	# for the GLIB package
 NULL =
 
--- a/gio/tests/Makefile.am
+++ b/gio/tests/Makefile.am
@@ -5,6 +5,9 @@
 
 SUBDIRS = gdbus-object-manager-example services modules
 
+# Some tests need a dbus session
+GTESTER_ENV = dbus-launch
+
 LDADD = \
 	$(top_builddir)/gio/libgio-2.0.la		\
 	$(top_builddir)/gobject/libgobject-2.0.la	\
